<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cn.momojie.moquant.api.dao.MqDailyBasicDao">

  <resultMap id="BasicMap" type="com.cn.momojie.moquant.api.dto.MqDailyBasic">
    <result column="ts_code" jdbcType="VARCHAR" property="tsCode" />
  </resultMap>

    <resultMap id="IndicatorMap" type="com.cn.momojie.moquant.api.dto.MqDailyIndicator">
        <result column="ts_code" jdbcType="VARCHAR" property="tsCode" />
        <result column="update_date" jdbcType="VARCHAR" property="updateDate" />
        <result column="period" jdbcType="VARCHAR" property="period" />
        <result column="reportType" jdbcType="INTEGER" property="reportType" />
        <result column="name" jdbcType="VARCHAR" property="name" />
        <result column="value" jdbcType="DECIMAL" property="value" />
    </resultMap>

  <select id="getScoreList" parameterType="com.cn.momojie.moquant.api.param.MqShareListParam"
          resultMap="BasicMap">
    SELECT
    *
    FROM
    (
        SELECT *
        FROM mq_daily_indicator
        WHERE name = #{scoreBy} AND value > 0 AND update_date >= #{yesterday}
        ORDER BY update_date DESC
        LIMIT 10000
    ) o
    GROUP BY ts_code
    ORDER BY value DESC
  </select>

    <select id="getDailyLatest" resultMap="BaseResultMap">
    SELECT
    *
    FROM
    (
        SELECT *
        FROM mq_daily_indicator
        WHERE update_date >= #{yesterday}
        AND ts_code IN <foreach collection="codeList" item="code" open="(" separator="," close=")">#{code}</foreach>
        ORDER BY update_date DESC
        LIMIT 10000
    ) o
    GROUP BY ts_code, name
  </select>
</mapper>