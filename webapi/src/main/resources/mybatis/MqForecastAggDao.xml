<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cn.momojie.moquant.api.dao.MqForecastAggDao">

      <resultMap id="BaseResultMap" type="com.cn.momojie.moquant.api.dto.MqForecastAgg">
        <id column="ts_code" jdbcType="VARCHAR" property="tsCode" />
        <id column="ann_date" jdbcType="VARCHAR" property="annDate" />
        <id column="end_date" jdbcType="VARCHAR" property="endDate" />
        <result column="revenue" jdbcType="DECIMAL" property="revenue" />
        <result column="revenue_ly" jdbcType="DECIMAL" property="revenueLy" />
        <result column="nprofit" jdbcType="DECIMAL" property="nprofit" />
        <result column="nprofit_ly" jdbcType="DECIMAL" property="nprofitLy" />
        <result column="dprofit" jdbcType="DECIMAL" property="dprofit" />
        <result column="dprofit_ly" jdbcType="DECIMAL" property="dprofitLy" />
        <result column="changed_reason" jdbcType="VARCHAR" property="changedReason" />
        <result column="manual_adjust_reason" jdbcType="VARCHAR" property="manualAdjustReason" />
        <result column="from_manual" jdbcType="BIT" property="fromManual" />
        <result column="one_time" jdbcType="BIT" property="oneTime" />
      </resultMap>

    <select id="selectLatest" resultMap="BaseResultMap">
        SELECT * FROM mq_forecast_agg
        WHERE 1=1
        <if test="ts_code != null">
            AND ts_code = #{ts_code}
        </if>
        ORDER BY end_date DESC, ann_date DESC
        LIMIT 1
    </select>
</mapper>