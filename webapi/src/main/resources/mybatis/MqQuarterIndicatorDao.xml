<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cn.momojie.moquant.api.dao.MqQuarterIndicatorDao">

    <resultMap id="QuarterMap" type="com.cn.momojie.moquant.api.dto.MqQuarterIndicator">
        <result column="ts_code" jdbcType="VARCHAR" property="tsCode"/>
        <result column="period" jdbcType="VARCHAR" property="period"/>
        <result column="report_type" jdbcType="INTEGER" property="reportType"/>
        <result column="update_date" jdbcType="VARCHAR" property="updateDate"/>
        <result column="name" jdbcType="VARCHAR" property="name"/>
        <result column="value" jdbcType="DECIMAL" property="value"/>
        <result column="yoy" jdbcType="DECIMAL" property="yoy"/>
        <result column="mom" jdbcType="DECIMAL" property="mom"/>
    </resultMap>

    <select id="getQuarterLatest" resultMap="DailyMap">
        SELECT *
        FROM
        (
            SELECT * FROM mq_daily_indicator
            WHERE ts_code IN <foreach collection="codeList" item="codeI" open="(" separator="," close=")">#{codeI}</foreach>
            <if test="nameList != null and nameList.size > 0">
                AND name IN <foreach collection="nameList" item="nameI" open="(" separator="," close=")">#{nameI}</foreach>
            </if>
            AND period <![CDATA[ >= ]]> #{fromPeriod}
            AND value > 0
            ORDER BY period DESC, update_date DESC LIMIT 5000
	    ) o
	    GROUP BY ts_code, name
    </select>

</mapper>